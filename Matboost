<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathBoost - –û—Ü–µ–Ω–∫–∏ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ</title>
    
    <!-- Favicon - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='0%' y2='100%'><stop offset='0%' stop-color='%23b886eb'/><stop offset='100%' stop-color='%231f0836'/></linearGradient></defs><path d='M50 15 L60 40 L75 45 L60 50 L65 65 L50 60 L35 65 L40 50 L25 45 L40 40 Z' fill='url(%23grad)'/><path d='M50 60 L50 85' stroke='%23b886eb' stroke-width='5' stroke-linecap='round'/><path d='M30 70 Q50 75 70 70' stroke='%231f0836' stroke-width='3' fill='none'/></svg>">
    
    <style>
        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root {
            --primary-light: #b886eb;
            --primary-dark: #1f0836;
            --secondary-light: #1f0836;
            --secondary-dark: #b886eb;
            --background-light: #ffffff;
            --background-dark: #1f0836;
            --text-light: #333333;
            --text-dark: #ffffff;
            --card-light: #f8f9fa;
            --card-dark: #2a1a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-light);
            color: var(--text-light);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è */
        .recovery-code-display {
            background: #f8f9fa;
            border: 2px solid var(--primary-light);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-light);
            font-family: monospace;
            letter-spacing: 3px;
        }

        body.dark-mode .recovery-code-display {
            background: #2a1a4a;
            border-color: var(--primary-light);
            color: var(--primary-light);
        }

        .code-hint {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 10px;
            font-style: italic;
        }

        body.dark-mode .code-hint {
            color: #aaa;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
        .work-type-btn {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        body.dark-mode .work-type-btn {
            background: var(--background-dark);
            border-color: #444;
            color: var(--text-dark);
        }

        .work-type-btn.active {
            border-color: var(--primary-light);
            background: var(--primary-light);
            color: white;
        }

        /* –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
        body.dark-mode .work-type-btn.active {
            background: #b886eb;
            color: white;
            border-color: #b886eb;
        }

        .user-type-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        body.dark-mode .user-type-btn {
            background: var(--background-dark);
            border-color: #444;
            color: var(--text-dark);
        }

        .user-type-btn.active {
            border-color: var(--primary-light);
            background: var(--primary-light);
            color: white;
        }

        /* –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
        body.dark-mode .user-type-btn.active {
            background: #b886eb;
            color: white;
            border-color: #b886eb;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .grades-controls {
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--card-light);
            border-radius: 10px;
        }

        body.dark-mode .grades-controls {
            background: var(--card-dark);
        }

        .work-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .topic-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 1rem;
        }

        body.dark-mode .topic-input {
            background: var(--background-dark);
            border-color: #444;
            color: var(--text-dark);
        }

        .grades-table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .grades-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .grades-table th, .grades-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            vertical-align: middle;
        }

        body.dark-mode .grades-table th, 
        body.dark-mode .grades-table td {
            border-color: #444;
        }

        .grades-table th {
            background: var(--primary-light);
            color: white;
            font-weight: 600;
        }

        body.dark-mode .grades-table th {
            background: var(--primary-dark);
        }

        .student-name {
            text-align: left;
            font-weight: 600;
            background: var(--card-light);
        }

        body.dark-mode .student-name {
            background: var(--card-dark);
        }

        .grade-input {
            width: 60px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        body.dark-mode .grade-input {
            background: var(--background-dark);
            border-color: #444;
            color: var(--text-dark);
        }

        .grade-input:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .average-grade {
            font-weight: bold;
            color: var(--primary-light);
        }

        .attestation {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .attestation.passed {
            background: #d4edda;
            color: #155724;
        }

        .attestation.failed {
            background: #f8d7da;
            color: #721c24;
        }

        body.dark-mode .attestation.passed {
            background: #155724;
            color: #d4edda;
        }

        body.dark-mode .attestation.failed {
            background: #721c24;
            color: #f8d7da;
        }

        .save-grades-btn {
            margin-top: 1rem;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .save-grades-btn:hover {
            background: #218838;
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            text-align: center;
            max-width: 400px;
            width: 90%;
            display: none;
        }

        body.dark-mode .notification {
            background: var(--card-dark);
        }

        .notification.active {
            display: block;
        }

        .notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }

        .notification-overlay.active {
            display: block;
        }

        .notification-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--primary-light);
        }

        .notification-message {
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .notification-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
        }

        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        body.dark-mode .auth-box {
            background: var(--card-dark);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }

        body.dark-mode .auth-tabs {
            border-bottom-color: #444;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--primary-light);
            border-bottom: 3px solid var(--primary-light);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        body.dark-mode .form-control {
            background: var(--background-dark);
            border-color: #444;
            color: var(--text-dark);
        }

        .form-control:focus {
            border-color: var(--primary-light);
            outline: none;
        }

        .form-control.error {
            border-color: #ff4444;
        }

        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-danger {
            background: #ff4444;
        }

        .btn-danger:hover {
            background: #cc0000;
        }

        .btn-logout {
            background: #6c757d;
        }

        .btn-logout:hover {
            background: #545b62;
        }

        .user-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .forgot-password {
            text-align: center;
            margin-top: 1rem;
        }

        .forgot-password a {
            color: var(--primary-light);
            text-decoration: none;
            cursor: pointer;
        }

        .app-container {
            display: none;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary-light);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode header {
            background-color: var(--primary-dark);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-buttons {
            display: flex;
            gap: 5px;
        }

        .theme-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .user-profile-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .main-content {
            padding: 2rem 0;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--card-light);
            border-radius: 15px;
        }

        body.dark-mode .profile-header {
            background: var(--card-dark);
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .user-role {
            color: var(--primary-light);
            margin-top: 0.5rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .feature-card {
            background: var(--card-light);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        body.dark-mode .feature-card {
            background: var(--card-dark);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-light);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: var(--secondary-light);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 2rem;
            transition: all 0.3s;
        }

        body.dark-mode .feature-icon {
            background: var(--secondary-dark);
        }

        .feature-card:hover .feature-icon {
            transform: translateY(-10px);
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        body.dark-mode .modal-content {
            background: var(--card-dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }

        .group-code {
            background: #f0f0f0;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            text-align: center;
            font-size: 1.2rem;
        }

        body.dark-mode .group-code {
            background: #333;
        }

        .groups-list {
            margin-top: 1rem;
        }

        .group-item {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .group-item {
            border-color: #444;
        }

        .group-actions {
            display: flex;
            gap: 10px;
        }

        .avatar-upload {
            text-align: center;
            margin: 1rem 0;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: #ddd;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode .avatar-preview {
            background: #444;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .danger-zone {
            margin-top: 2rem;
            padding: 1rem;
            border: 2px solid #ff4444;
            border-radius: 8px;
        }

        .logout-zone {
            margin-top: 1rem;
            padding: 1rem;
            border: 2px solid #6c757d;
            border-radius: 8px;
        }

        .code-input {
            font-size: 2rem;
            letter-spacing: 10px;
            text-align: center;
            font-family: monospace;
        }

        .timer {
            text-align: center;
            margin: 1rem 0;
            font-size: 1.2rem;
            color: var(--primary-light);
            font-weight: bold;
        }

        .average-score {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-light);
            margin: 2rem 0;
        }

        .teacher-actions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        body.dark-mode .teacher-actions {
            border-top-color: #444;
        }

        .no-groups {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-style: italic;
        }

        body.dark-mode .no-groups {
            color: #999;
        }

        .student-grades {
            background: var(--card-light);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        body.dark-mode .student-grades {
            background: var(--card-dark);
        }

        .group-selector {
            margin-bottom: 1rem;
        }

        .group-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .success-message {
            color: #28a745;
            text-align: center;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            display: none;
        }

        .success-message.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification-overlay" id="notificationOverlay"></div>
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
        <div class="notification-message" id="notificationMessage"></div>
        <div class="notification-buttons">
            <button class="btn" id="notificationOk">OK</button>
            <button class="btn btn-danger" id="notificationCancel" style="display: none;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-tabs">
                <button class="auth-tab active" data-form="login">–í–æ–π—Ç–∏</button>
                <button class="auth-tab" data-form="register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    <div class="error-message" id="loginEmailError"></div>
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="loginPassword" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
                        <button class="toggle-password" type="button">üëÅÔ∏è</button>
                    </div>
                    <div class="error-message" id="loginPasswordError"></div>
                </div>
                <button class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
                <div class="forgot-password">
                    <a href="#" onclick="showForgotPassword()">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="auth-form" id="registerForm">
                <div class="user-type-selector">
                    <button class="user-type-btn active" data-type="student">–£—á–µ–Ω–∏–∫</button>
                    <button class="user-type-btn" data-type="teacher">–£—á–∏—Ç–µ–ª—å</button>
                </div>
                <div class="form-group">
                    <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    <div class="error-message" id="registerEmailError"></div>
                </div>
                <div class="form-group">
                    <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" class="form-control" id="registerPhone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
                    <div class="error-message" id="registerPhoneError"></div>
                </div>
                <div class="form-group">
                    <label>–§–∞–º–∏–ª–∏—è</label>
                    <input type="text" class="form-control" id="registerLastName" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
                    <div class="error-message" id="registerLastNameError"></div>
                </div>
                <div class="form-group">
                    <label>–ò–º—è</label>
                    <input type="text" class="form-control" id="registerFirstName" placeholder="–í–∞—à–µ –∏–º—è">
                    <div class="error-message" id="registerFirstNameError"></div>
                </div>
                <div class="form-group">
                    <label>–û—Ç—á–µ—Å—Ç–≤–æ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
                    <input type="text" class="form-control" id="registerMiddleName" placeholder="–í–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="registerPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        <button class="toggle-password" type="button">üëÅÔ∏è</button>
                    </div>
                    <div class="error-message" id="registerPasswordError"></div>
                </div>
                <div class="form-group">
                    <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button class="toggle-password" type="button">üëÅÔ∏è</button>
                    </div>
                    <div class="error-message" id="registerPasswordConfirmError"></div>
                </div>
                <button class="btn" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="app-container" id="appContainer">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">üöÄ</div>
                        MathBoost
                    </div>
                    <div class="user-menu">
                        <div class="theme-buttons">
                            <button class="theme-btn" onclick="setLightMode()">‚òÄÔ∏è</button>
                            <button class="theme-btn" onclick="setDarkMode()">üåô</button>
                        </div>
                        <button class="user-profile-btn" onclick="showProfileModal()">üë§</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container main-content">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="profile-header">
                <div class="avatar" id="userAvatar">
                    <span id="avatarPlaceholder">üë§</span>
                </div>
                <div class="user-name" id="userName">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</div>
                <div class="user-role" id="userRole">–£—á–µ–Ω–∏–∫</div>
            </div>

            <!-- –°–µ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π -->
            <div class="features-grid">
                <div class="feature-card" onclick="showProfileModal()">
                    <div class="feature-icon">üë§</div>
                    <div class="feature-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
                </div>
                <div class="feature-card" onclick="showGroupsModal()">
                    <div class="feature-icon">üë•</div>
                    <div class="feature-title">–ì—Ä—É–ø–ø—ã</div>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–±–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏</p>
                </div>
                <div class="feature-card" onclick="showGradesModal()">
                    <div class="feature-icon">üìä</div>
                    <div class="feature-title">–û—Ü–µ–Ω–∫–∏</div>
                    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</p>
                </div>
                <div class="feature-card" onclick="showScoreModal()">
                    <div class="feature-icon">‚≠ê</div>
                    <div class="feature-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                    <p>–†–∞—Å—á–µ—Ç —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <button class="close-modal" onclick="closeModal('profileModal')">√ó</button>
            </div>
            
            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
            <div id="teacherGroupSection" style="display: none;">
                <h3>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                    <input type="text" class="form-control" id="newGroupName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
                </div>
                <button class="btn" onclick="createGroup()">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                
                <div class="teacher-actions" id="teacherGroupsList">
                    <h3>–ú–æ–∏ –≥—Ä—É–ø–ø—ã</h3>
                    <div id="createdGroupsList"></div>
                </div>
            </div>
            
            <div class="avatar-upload">
                <div class="avatar-preview" id="avatarPreview">
                    <span id="avatarPreviewPlaceholder">üë§</span>
                </div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                <button class="btn" onclick="document.getElementById('avatarInput').click()">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
            </div>
            <div class="form-group">
                <label>–ò–º—è</label>
                <input type="text" class="form-control" id="profileFirstName" placeholder="–í–∞—à–µ –∏–º—è">
            </div>
            <div class="form-group">
                <label>–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-control" id="profileLastName" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
            </div>
            <div class="form-group">
                <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input type="email" class="form-control" id="profileEmail" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
            </div>
            <div class="form-group">
                <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" class="form-control" id="profilePhone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
            </div>
            <div class="form-group">
                <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" class="form-control" id="profileMiddleName" placeholder="–í–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
            </div>
            <button class="btn" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            
            <div class="logout-zone">
                <h3>–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</h3>
                <button class="btn btn-logout" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            </div>
            
            <div class="danger-zone">
                <h3>–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h3>
                <button class="btn btn-danger" onclick="deleteAccount()">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥—Ä—É–ø–ø -->
    <div class="modal" id="groupsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ì—Ä—É–ø–ø—ã</div>
                <button class="close-modal" onclick="closeModal('groupsModal')">√ó</button>
            </div>
            <div class="form-group">
                <label>–ö–æ–¥ –≥—Ä—É–ø–ø—ã</label>
                <input type="text" class="form-control" id="groupCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≥—Ä—É–ø–ø—ã">
            </div>
            <button class="btn" onclick="joinGroup()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–µ</button>
            <div class="groups-list">
                <h3>–ú–æ–∏ –≥—Ä—É–ø–ø—ã</h3>
                <div id="userGroupsList"></div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ü–µ–Ω–æ–∫ -->
    <div class="modal" id="gradesModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="gradesModalTitle">–û—Ü–µ–Ω–∫–∏ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ</div>
                <button class="close-modal" onclick="closeModal('gradesModal')">√ó</button>
            </div>
            <div id="gradesContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ü–µ–Ω–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞ -->
    <div class="modal" id="scoreModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                <button class="close-modal" onclick="closeModal('scoreModal')">√ó</button>
            </div>
            <div class="average-score" id="averageScore">0.00</div>
            <p style="text-align: center;">–í–∞—à —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è -->
    <div class="modal" id="forgotPasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</div>
                <button class="close-modal" onclick="closeForgotPasswordModal()">√ó</button>
            </div>
            <div id="forgotPasswordStep1">
                <div class="form-group">
                    <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                    <input type="email" class="form-control" id="recoveryEmail" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    <div class="error-message" id="recoveryEmailError"></div>
                </div>
                <button class="btn" onclick="sendRecoveryCode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
            </div>
            <div id="forgotPasswordStep2" style="display: none;">
                <div class="timer" id="recoveryTimer">40</div>
                <div class="recovery-code-display" id="recoveryCodeDisplay">
                    <!-- –ö–æ–¥ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
                <div class="code-hint">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤–≤–µ–¥–∏—Ç–µ –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</div>
                <div class="form-group">
                    <label>–ö–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</label>
                    <input type="text" class="form-control code-input" id="recoveryCode" maxlength="6" placeholder="000000">
                    <div class="error-message" id="recoveryCodeError"></div>
                </div>
                <div class="success-message" id="codeSuccessMessage">
                    –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.
                </div>
                <button class="btn" onclick="verifyRecoveryCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
            </div>
            <div id="forgotPasswordStep3" style="display: none;">
                <div class="form-group">
                    <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        <button class="toggle-password" type="button">üëÅÔ∏è</button>
                    </div>
                    <div class="error-message" id="newPasswordError"></div>
                </div>
                <div class="form-group">
                    <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="newPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        <button class="toggle-password" type="button">üëÅÔ∏è</button>
                    </div>
                    <div class="error-message" id="newPasswordConfirmError"></div>
                </div>
                <button class="btn" onclick="changePassword()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>
        </div>
    </div>

    <script>
        // –í–µ—Å—å JavaScript –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        const DB = {
            users: JSON.parse(localStorage.getItem('mathBoostUsers')) || {},
            groups: JSON.parse(localStorage.getItem('mathBoostGroups')) || {},
            studentGroups: JSON.parse(localStorage.getItem('mathBoostStudentGroups')) || {},
            grades: JSON.parse(localStorage.getItem('mathBoostGrades')) || {},
            recoveryCodes: JSON.parse(localStorage.getItem('mathBoostRecoveryCodes')) || {}
        };

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('mathBoostUsers', JSON.stringify(DB.users));
            localStorage.setItem('mathBoostGroups', JSON.stringify(DB.groups));
            localStorage.setItem('mathBoostStudentGroups', JSON.stringify(DB.studentGroups));
            localStorage.setItem('mathBoostGrades', JSON.stringify(DB.grades));
            localStorage.setItem('mathBoostRecoveryCodes', JSON.stringify(DB.recoveryCodes));
        }

        // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –¥–∞–Ω–Ω—ã–µ
        let currentUser = null;
        let userType = 'student';
        let recoveryTimer = null;
        let currentRecoveryEmail = '';
        let currentWorkType = 'homework';
        let currentTopic = '';
        let currentRecoveryCode = '';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(title, message, callback, showCancel = false) {
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            document.getElementById('notificationOverlay').classList.add('active');
            document.getElementById('notification').classList.add('active');
            
            const okButton = document.getElementById('notificationOk');
            const cancelButton = document.getElementById('notificationCancel');
            
            if (showCancel) {
                cancelButton.style.display = 'inline-block';
                cancelButton.onclick = function() {
                    hideNotification();
                };
            } else {
                cancelButton.style.display = 'none';
            }
            
            okButton.onclick = function() {
                hideNotification();
                if (callback) callback();
            };
        }

        function hideNotification() {
            document.getElementById('notificationOverlay').classList.remove('active');
            document.getElementById('notification').classList.remove('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                updateUserInterface();
            }
        });

        function initializeEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const formType = this.getAttribute('data-form');
                    showAuthForm(formType);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    setUserType(type);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –ø–∞—Ä–æ–ª—è
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('.form-control');
                    togglePassword(input, this);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
            document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
        }

        function showAuthForm(formType) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ —Ñ–æ—Ä–º—É
            document.querySelector(`.auth-tab[data-form="${formType}"]`).classList.add('active');
            document.getElementById(formType + 'Form').classList.add('active');
        }

        function setUserType(type) {
            userType = type;
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelector(`.user-type-btn[data-type="${type}"]`).classList.add('active');
        }

        function togglePassword(input, button) {
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        function handleAvatarUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreview').innerHTML = '<img src="' + e.target.result + '">';
                    document.getElementById('userAvatar').innerHTML = '<img src="' + e.target.result + '">';
                    if (currentUser) {
                        currentUser.avatar = e.target.result;
                        DB.users[currentUser.email].avatar = e.target.result;
                        saveData();
                    }
                }
                reader.readAsDataURL(file);
            }
        }

        function showError(inputId, message) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + 'Error');
            input.classList.add('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function hideError(inputId) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + 'Error');
            input.classList.remove('error');
            errorElement.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            hideError('loginEmail');
            hideError('loginPassword');

            let hasErrors = false;

            if (!email) {
                showError('loginEmail', '–í–≤–µ–¥–∏—Ç–µ email');
                hasErrors = true;
            }

            if (!password) {
                showError('loginPassword', '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                hasErrors = true;
            }

            if (hasErrors) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (!DB.users[email]) {
                showError('loginEmail', '–ê–∫–∫–∞—É–Ω—Ç —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
            if (DB.users[email].password !== password) {
                showError('loginPassword', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                return;
            }

            // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
            currentUser = DB.users[email];
            userType = currentUser.type;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            updateUserInterface();
            
            showNotification('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MathBoost!');
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function register() {
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const lastName = document.getElementById('registerLastName').value;
            const firstName = document.getElementById('registerFirstName').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            ['registerEmail', 'registerPhone', 'registerLastName', 'registerFirstName', 'registerPassword', 'registerPasswordConfirm'].forEach(hideError);

            let hasErrors = false;

            if (!email) {
                showError('registerEmail', '–í–≤–µ–¥–∏—Ç–µ email');
                hasErrors = true;
            } else if (DB.users[email]) {
                showError('registerEmail', '–ê–∫–∫–∞—É–Ω—Ç —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                hasErrors = true;
            }

            if (!phone) {
                showError('registerPhone', '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                hasErrors = true;
            }

            if (!lastName) {
                showError('registerLastName', '–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é');
                hasErrors = true;
            }

            if (!firstName) {
                showError('registerFirstName', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                hasErrors = true;
            }

            if (!password) {
                showError('registerPassword', '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                hasErrors = true;
            }

            if (!passwordConfirm) {
                showError('registerPasswordConfirm', '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                hasErrors = true;
            }

            if (password !== passwordConfirm) {
                showError('registerPasswordConfirm', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                hasErrors = true;
            }

            if (hasErrors) return;

            // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = {
                email: email,
                phone: phone,
                firstName: firstName,
                lastName: lastName,
                middleName: document.getElementById('registerMiddleName').value,
                password: password,
                type: userType,
                avatar: null
            };

            DB.users[email] = user;
            saveData();

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            updateUserInterface();
            
            showNotification('–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MathBoost!');
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
        function showForgotPassword() {
            document.getElementById('forgotPasswordModal').style.display = 'flex';
            document.getElementById('forgotPasswordStep1').style.display = 'block';
            document.getElementById('forgotPasswordStep2').style.display = 'none';
            document.getElementById('forgotPasswordStep3').style.display = 'none';
            document.getElementById('codeSuccessMessage').classList.remove('active');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            ['recoveryEmail', 'recoveryCode', 'newPassword', 'newPasswordConfirm'].forEach(hideError);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('recoveryEmail').value = '';
            document.getElementById('recoveryCode').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newPasswordConfirm').value = '';
        }

        function closeForgotPasswordModal() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞
            if (recoveryTimer) {
                clearInterval(recoveryTimer);
                recoveryTimer = null;
            }
            closeModal('forgotPasswordModal');
        }

        function sendRecoveryCode() {
            const email = document.getElementById('recoveryEmail').value;
            
            hideError('recoveryEmail');
            
            if (!email) {
                showError('recoveryEmail', '–í–≤–µ–¥–∏—Ç–µ email');
                return;
            }

            if (!DB.users[email]) {
                showError('recoveryEmail', '–ê–∫–∫–∞—É–Ω—Ç —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
            currentRecoveryCode = Math.floor(100000 + Math.random() * 900000).toString();
            DB.recoveryCodes[email] = {
                code: currentRecoveryCode,
                timestamp: Date.now()
            };
            saveData();
            
            currentRecoveryEmail = email;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ —Å—Ä–∞–∑—É –≤ –æ–∫–Ω–µ
            document.getElementById('forgotPasswordStep1').style.display = 'none';
            document.getElementById('forgotPasswordStep2').style.display = 'block';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–¥ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –±–ª–æ–∫–µ
            document.getElementById('recoveryCodeDisplay').textContent = currentRecoveryCode;

            let timeLeft = 40;
            const timerElement = document.getElementById('recoveryTimer');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
            if (recoveryTimer) {
                clearInterval(recoveryTimer);
            }
            
            recoveryTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(recoveryTimer);
                    recoveryTimer = null;
                    showNotification('–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ', '–í—Ä–µ–º—è –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                    showForgotPassword();
                }
            }, 1000);
        }

        function verifyRecoveryCode() {
            const code = document.getElementById('recoveryCode').value;
            
            hideError('recoveryCode');
            
            if (code.length !== 6) {
                showError('recoveryCode', '–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
                return;
            }

            const recoveryData = DB.recoveryCodes[currentRecoveryEmail];
            if (!recoveryData || recoveryData.code !== code) {
                showError('recoveryCode', '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –ª–∏ –≤—Ä–µ–º—è –∫–æ–¥–∞ (5 –º–∏–Ω—É—Ç)
            if (Date.now() - recoveryData.timestamp > 5 * 60 * 1000) {
                showError('recoveryCode', '–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ');
                return;
            }

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            if (recoveryTimer) {
                clearInterval(recoveryTimer);
                recoveryTimer = null;
            }

            document.getElementById('forgotPasswordStep2').style.display = 'none';
            document.getElementById('forgotPasswordStep3').style.display = 'block';
            document.getElementById('codeSuccessMessage').classList.add('active');
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const newPasswordConfirm = document.getElementById('newPasswordConfirm').value;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            hideError('newPassword');
            hideError('newPasswordConfirm');

            let hasErrors = false;

            if (!newPassword) {
                showError('newPassword', '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å');
                hasErrors = true;
            }

            if (!newPasswordConfirm) {
                showError('newPasswordConfirm', '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å');
                hasErrors = true;
            }

            if (newPassword !== newPasswordConfirm) {
                showError('newPasswordConfirm', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                hasErrors = true;
            }

            if (hasErrors) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å
            if (DB.users[currentRecoveryEmail]) {
                DB.users[currentRecoveryEmail].password = newPassword;
                saveData();
                
                // –£–¥–∞–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
                delete DB.recoveryCodes[currentRecoveryEmail];
                saveData();
            }

            showNotification('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω', '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º.', function() {
                closeForgotPasswordModal();
                showAuthForm('login');
            });
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...

        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        function logout() {
            showNotification('–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?', function() {
                currentUser = null;
                localStorage.removeItem('currentUser');
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('authContainer').style.display = 'flex';
                closeModal('profileModal');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                hideError('loginEmail');
                hideError('loginPassword');
            }, true);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserInterface() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.lastName + ' ' + currentUser.firstName;
            document.getElementById('userRole').textContent = currentUser.type === 'teacher' ? '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å' : '–£—á–µ–Ω–∏–∫';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('profileFirstName').value = currentUser.firstName;
            document.getElementById('profileLastName').value = currentUser.lastName;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.phone;
            document.getElementById('profileMiddleName').value = currentUser.middleName || '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
            if (currentUser.avatar) {
                document.getElementById('avatarPreview').innerHTML = '<img src="' + currentUser.avatar + '">';
                document.getElementById('userAvatar').innerHTML = '<img src="' + currentUser.avatar + '">';
            } else {
                document.getElementById('avatarPreview').innerHTML = '<span id="avatarPreviewPlaceholder">üë§</span>';
                document.getElementById('userAvatar').innerHTML = '<span id="avatarPlaceholder">üë§</span>';
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
            if (currentUser.type === 'teacher') {
                document.getElementById('teacherGroupSection').style.display = 'block';
                updateCreatedGroupsList();
            } else {
                document.getElementById('teacherGroupSection').style.display = 'none';
            }
            
            updateUserGroupsList();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function showProfileModal() {
            document.getElementById('profileModal').style.display = 'flex';
        }

        function showGroupsModal() {
            document.getElementById('groupsModal').style.display = 'flex';
            updateUserGroupsList();
        }

        function showGradesModal() {
            document.getElementById('gradesModal').style.display = 'flex';
            loadGradesContent();
        }

        function showScoreModal() {
            document.getElementById('scoreModal').style.display = 'flex';
            calculateAverageScore();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏
        function setLightMode() {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
        }

        function setDarkMode() {
            document.body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä—É–ø–ø–∞–º–∏
        function createGroup() {
            const name = document.getElementById('newGroupName').value;
            
            if (!name) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                return;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –≥—Ä—É–ø–ø—ã
            const code = 'GRP' + Math.floor(1000 + Math.random() * 9000);
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É
            DB.groups[code] = {
                code: code,
                name: name,
                teacherEmail: currentUser.email,
                created: new Date().toISOString(),
                students: []
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
            updateCreatedGroupsList();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            document.getElementById('newGroupName').value = '';
            
            showNotification('–ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞', `–ì—Ä—É–ø–ø–∞ "${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –ö–æ–¥ –≥—Ä—É–ø–ø—ã: ${code}`);
        }
        
        function updateCreatedGroupsList() {
            const groupsList = document.getElementById('createdGroupsList');
            groupsList.innerHTML = '';
            
            // –ù–∞—Ö–æ–¥–∏–º –≥—Ä—É–ø–ø—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–∏–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º
            const teacherGroups = Object.values(DB.groups).filter(group => 
                group.teacherEmail === currentUser.email
            );
            
            if (teacherGroups.length === 0) {
                groupsList.innerHTML = '<div class="no-groups">–í—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã</div>';
                return;
            }
            
            teacherGroups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'group-item';
                groupElement.innerHTML = `
                    <div class="group-info">
                        <h4>${group.name}</h4>
                        <p>–ö–æ–¥: ${group.code}</p>
                        <p>–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${group.students ? group.students.length : 0}</p>
                    </div>
                    <div class="group-actions">
                        <button class="btn btn-small" onclick="viewGroupStudents('${group.code}')">üë•</button>
                        <button class="btn btn-small btn-danger" onclick="deleteGroup('${group.code}')">üóëÔ∏è</button>
                    </div>
                `;
                groupsList.appendChild(groupElement);
            });
        }
        
        function updateUserGroupsList() {
            const userGroupsList = document.getElementById('userGroupsList');
            userGroupsList.innerHTML = '';
            
            if (currentUser.type === 'student') {
                // –î–ª—è —É—á–µ–Ω–∏–∫–∞: –Ω–∞—Ö–æ–¥–∏–º –≥—Ä—É–ø–ø—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω —Å–æ—Å—Ç–æ–∏—Ç
                const studentGroups = Object.values(DB.groups).filter(group => 
                    group.students && group.students.includes(currentUser.email)
                );
                
                if (studentGroups.length === 0) {
                    userGroupsList.innerHTML = '<div class="no-groups">–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –Ω–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ</div>';
                } else {
                    studentGroups.forEach(group => {
                        const groupElement = document.createElement('div');
                        groupElement.className = 'group-item';
                        groupElement.innerHTML = `
                            <div class="group-info">
                                <h4>${group.name}</h4>
                                <p>–ö–æ–¥: ${group.code}</p>
                                <p>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${DB.users[group.teacherEmail].firstName} ${DB.users[group.teacherEmail].lastName}</p>
                            </div>
                            <div class="group-actions">
                                <button class="btn btn-small btn-danger" onclick="leaveGroup('${group.code}')">–í—ã–π—Ç–∏</button>
                            </div>
                        `;
                        userGroupsList.appendChild(groupElement);
                    });
                }
            } else {
                // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–º –≥—Ä—É–ø–ø—ã
                updateCreatedGroupsList();
            }
        }
        
        function joinGroup() {
            const groupCode = document.getElementById('groupCodeInput').value.toUpperCase();
            
            if (!groupCode) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≥—Ä—É–ø–ø—ã');
                return;
            }
            
            const group = DB.groups[groupCode];
            if (!group) {
                showNotification('–û—à–∏–±–∫–∞', '–ì—Ä—É–ø–ø–∞ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            if (group.students && group.students.includes(currentUser.email)) {
                showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
            if (!group.students) {
                group.students = [];
            }
            group.students.push(currentUser.email);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveData();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            document.getElementById('groupCodeInput').value = '';
            
            showNotification('–£—Å–ø–µ—Ö', `–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –≥—Ä—É–ø–ø–µ "${group.name}"`);
            updateUserGroupsList();
        }
        
        function leaveGroup(groupCode) {
            const group = DB.groups[groupCode];
            if (!group) return;
            
            showNotification('–í—ã—Ö–æ–¥ –∏–∑ –≥—Ä—É–ø–ø—ã', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –≥—Ä—É–ø–ø—ã "${group.name}"?`, function() {
                if (group.students) {
                    group.students = group.students.filter(email => email !== currentUser.email);
                    saveData();
                    updateUserGroupsList();
                    showNotification('–£—Å–ø–µ—Ö', `–í—ã –≤—ã—à–ª–∏ –∏–∑ –≥—Ä—É–ø–ø—ã "${group.name}"`);
                }
            }, true);
        }
        
        function deleteGroup(groupCode) {
            const group = DB.groups[groupCode];
            if (!group) return;
            
            showNotification('–£–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É "${group.name}"?`, function() {
                delete DB.groups[groupCode];
                saveData();
                updateCreatedGroupsList();
                showNotification('–£—Å–ø–µ—Ö', `–ì—Ä—É–ø–ø–∞ "${group.name}" —É–¥–∞–ª–µ–Ω–∞`);
            }, true);
        }
        
        function viewGroupStudents(groupCode) {
            const group = DB.groups[groupCode];
            if (!group || !group.students) {
                showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤');
                return;
            }
            
            let studentList = '–°—Ç—É–¥–µ–Ω—Ç—ã –≤ –≥—Ä—É–ø–ø–µ:\n\n';
            group.students.forEach(studentEmail => {
                const student = DB.users[studentEmail];
                if (student) {
                    studentList += `${student.lastName} ${student.firstName}\n`;
                }
            });
            
            showNotification('–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤', studentList);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ü–µ–Ω–∫–∞–º–∏
        function loadGradesContent() {
            const container = document.getElementById('gradesContent');
            
            if (currentUser.type === 'teacher') {
                // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è - –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –∏ —Ç–∞–±–ª–∏—Ü–∞ –æ—Ü–µ–Ω–æ–∫
                const teacherGroups = Object.values(DB.groups).filter(group => group.teacherEmail === currentUser.email);
                
                if (teacherGroups.length === 0) {
                    container.innerHTML = '<div class="no-groups">–°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ—Ñ–∏–ª—å"</div>';
                    return;
                }
                
                let html = `
                    <div class="group-selector">
                        <select class="group-select" onchange="loadTeacherGradesTable(this.value)">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                            ${teacherGroups.map(group => 
                                `<option value="${group.code}">${group.name} (${group.code})</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div id="teacherGradesTable"></div>
                `;
                container.innerHTML = html;
            } else {
                // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –æ—Ü–µ–Ω–∫–∏
                loadStudentGrades();
            }
        }

        function loadTeacherGradesTable(groupCode) {
            const container = document.getElementById('teacherGradesTable');
            if (!groupCode) {
                container.innerHTML = '<div class="no-groups">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</div>';
                return;
            }

            const group = DB.groups[groupCode];
            
            document.getElementById('gradesModalTitle').textContent = `–û—Ü–µ–Ω–∫–∏ –≥—Ä—É–ø–ø—ã ${group.name}`;
            
            if (!group.students || group.students.length === 0) {
                container.innerHTML = '<div class="no-groups">–í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>';
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
            const groupGrades = DB.grades[groupCode] || {};

            let html = `
                <div class="grades-controls">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h3>
                    <div class="work-type-selector">
                        <button class="work-type-btn ${currentWorkType === 'homework' ? 'active' : ''}" onclick="setWorkType('homework')">–î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞</button>
                        <button class="work-type-btn ${currentWorkType === 'classwork' ? 'active' : ''}" onclick="setWorkType('classwork')">–ö–ª–∞—Å—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</button>
                        <button class="work-type-btn ${currentWorkType === 'test' ? 'active' : ''}" onclick="setWorkType('test')">–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è</button>
                        <button class="work-type-btn ${currentWorkType === 'quiz' ? 'active' : ''}" onclick="setWorkType('quiz')">–¢–µ—Å—Ç</button>
                    </div>
                    <input type="text" class="topic-input" id="topicInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É —Ä–∞–±–æ—Ç—ã" value="${currentTopic}" oninput="currentTopic = this.value">
                    <button class="save-grades-btn" onclick="saveAllGrades('${groupCode}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏</button>
                </div>
                <div class="grades-table-container">
                    <table class="grades-table">
                        <thead>
                            <tr>
                                <th rowspan="2">–°—Ç—É–¥–µ–Ω—Ç</th>
                                <th colspan="4">–¢–∏–ø—ã —Ä–∞–±–æ—Ç</th>
                                <th rowspan="2">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                                <th rowspan="2">–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è</th>
                            </tr>
                            <tr>
                                <th>–î–æ–º–∞—à–Ω–∏–µ</th>
                                <th>–ö–ª–∞—Å—Å–Ω—ã–µ</th>
                                <th>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ</th>
                                <th>–¢–µ—Å—Ç—ã</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            group.students.forEach(studentEmail => {
                const student = DB.users[studentEmail];
                const studentGrades = groupGrades[studentEmail] || {};
                
                // –°–æ–±–∏—Ä–∞–µ–º –æ—Ü–µ–Ω–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Ä–∞–±–æ—Ç
                const homeworkGrades = studentGrades.homework || [];
                const classworkGrades = studentGrades.classwork || [];
                const testGrades = studentGrades.test || [];
                const quizGrades = studentGrades.quiz || [];
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –±–∞–ª–ª—ã
                const homeworkAvg = calculateAverage(homeworkGrades);
                const classworkAvg = calculateAverage(classworkGrades);
                const testAvg = calculateAverage(testGrades);
                const quizAvg = calculateAverage(quizGrades);
                
                // –û–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
                const allGrades = [...homeworkGrades, ...classworkGrades, ...testGrades, ...quizGrades];
                const overallAvg = calculateAverage(allGrades);
                
                // –ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è
                const attestation = overallAvg >= 2.5 ? '–ê—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω' : '–ù–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω';
                const attestationClass = overallAvg >= 2.5 ? 'passed' : 'failed';

                html += `
                    <tr>
                        <td class="student-name">${student.lastName} ${student.firstName}</td>
                        <td>${homeworkAvg}</td>
                        <td>${classworkAvg}</td>
                        <td>${testAvg}</td>
                        <td>${quizAvg}</td>
                        <td class="average-grade">${overallAvg}</td>
                        <td><span class="attestation ${attestationClass}">${attestation}</span></td>
                    </tr>
                    <tr>
                        <td class="student-name" style="font-size: 12px; color: #666;">–í–≤–æ–¥ –æ—Ü–µ–Ω–∫–∏:</td>
                        <td colspan="4">
                            <input type="number" class="grade-input" id="grade_${studentEmail}" 
                                   min="0" max="5" placeholder="0-5" 
                                   onchange="updateStudentGrade('${groupCode}', '${studentEmail}', this.value)">
                            <small style="color: #666; margin-left: 5px;">(0 - –Ω–µ —Å–¥–∞–ª/–Ω–µ –±—ã–ª)</small>
                        </td>
                        <td colspan="2"></td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        function setWorkType(type) {
            currentWorkType = type;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.work-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function updateStudentGrade(groupCode, studentEmail, grade) {
            if (!grade || grade < 0 || grade > 5) {
                showNotification('–û—à–∏–±–∫–∞', '–û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 5');
                return;
            }

            const numericGrade = parseInt(grade);
            if (!currentTopic) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É —Ä–∞–±–æ—Ç—ã');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ü–µ–Ω–∫—É
            if (!DB.grades[groupCode]) {
                DB.grades[groupCode] = {};
            }
            if (!DB.grades[groupCode][studentEmail]) {
                DB.grades[groupCode][studentEmail] = {};
            }
            if (!DB.grades[groupCode][studentEmail][currentWorkType]) {
                DB.grades[groupCode][studentEmail][currentWorkType] = [];
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –æ—Ü–µ–Ω–∫—É
            DB.grades[groupCode][studentEmail][currentWorkType].push({
                grade: numericGrade,
                topic: currentTopic,
                date: new Date().toLocaleDateString('ru-RU'),
                type: currentWorkType
            });

            saveData();
            showNotification('–£—Å–ø–µ—Ö', `–û—Ü–µ–Ω–∫–∞ ${numericGrade} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
            loadTeacherGradesTable(groupCode);
        }

        function saveAllGrades(groupCode) {
            const group = DB.groups[groupCode];
            if (!group || !group.students) return;
            
            let savedCount = 0;

            group.students.forEach(studentEmail => {
                const gradeInput = document.getElementById(`grade_${studentEmail}`);
                if (gradeInput && gradeInput.value && currentTopic) {
                    const grade = parseInt(gradeInput.value);
                    if (grade >= 0 && grade <= 5) {
                        updateStudentGrade(groupCode, studentEmail, grade);
                        savedCount++;
                        gradeInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    }
                }
            });

            if (savedCount > 0) {
                showNotification('–£—Å–ø–µ—Ö', `–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${savedCount} –æ—Ü–µ–Ω–æ–∫`);
            } else {
                showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        function calculateAverage(grades) {
            if (!grades || grades.length === 0) return '0.00';
            const sum = grades.reduce((total, gradeObj) => total + gradeObj.grade, 0);
            return (sum / grades.length).toFixed(2);
        }

        function loadStudentGrades() {
            const container = document.getElementById('gradesContent');
            let html = '<div class="student-grades">';
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≥—Ä—É–ø–ø—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç —Å—Ç—É–¥–µ–Ω—Ç
            const studentGroups = Object.values(DB.groups).filter(group => 
                group.students && group.students.includes(currentUser.email)
            );
            
            if (studentGroups.length === 0) {
                html += '<div class="no-groups">–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –Ω–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ</div>';
            } else {
                studentGroups.forEach(group => {
                    const groupGrades = DB.grades[group.code] || {};
                    const studentGrades = groupGrades[currentUser.email] || {};
                    
                    html += `<h3>–ì—Ä—É–ø–ø–∞: ${group.name}</h3>`;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Ä–∞–±–æ—Ç
                    const workTypes = ['homework', 'classwork', 'test', 'quiz'];
                    workTypes.forEach(type => {
                        const grades = studentGrades[type] || [];
                        if (grades.length > 0) {
                            html += `<h4>${getWorkTypeName(type)}:</h4>`;
                            html += '<ul>';
                            grades.forEach(gradeObj => {
                                html += `<li>${gradeObj.topic}: ${gradeObj.grade} (${gradeObj.date})</li>`;
                            });
                            html += `</ul><p>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${calculateAverage(grades)}</p>`;
                        }
                    });
                    
                    // –û–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
                    const allGrades = Object.values(studentGrades).flat();
                    const overallAvg = calculateAverage(allGrades);
                    html += `<h4>–û–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${overallAvg}</h4>`;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function getWorkTypeName(type) {
            const names = {
                'homework': '–î–æ–º–∞—à–Ω–∏–µ —Ä–∞–±–æ—Ç—ã',
                'classwork': '–ö–ª–∞—Å—Å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                'test': '–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                'quiz': '–¢–µ—Å—Ç—ã'
            };
            return names[type] || type;
        }

        function calculateAverageScore() {
            if (!currentUser) return;
            
            let allGrades = [];
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≥—Ä—É–ø–ø—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç —Å—Ç—É–¥–µ–Ω—Ç
            const studentGroups = Object.values(DB.groups).filter(group => 
                group.students && group.students.includes(currentUser.email)
            );
            
            studentGroups.forEach(group => {
                const groupGrades = DB.grades[group.code] || {};
                const studentGrades = groupGrades[currentUser.email] || {};
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏
                Object.values(studentGrades).forEach(gradesArray => {
                    allGrades = allGrades.concat(gradesArray);
                });
            });
            
            const average = calculateAverage(allGrades);
            document.getElementById('averageScore').textContent = average;
        }

        function saveProfile() {
            if (!currentUser) return;
            
            const firstName = document.getElementById('profileFirstName').value;
            const lastName = document.getElementById('profileLastName').value;
            const email = document.getElementById('profileEmail').value;
            const phone = document.getElementById('profilePhone').value;
            const middleName = document.getElementById('profileMiddleName').value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser.firstName = firstName;
            currentUser.lastName = lastName;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.middleName = middleName;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            DB.users[currentUser.email] = currentUser;
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUserInterface();
            
            showNotification('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', '–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function deleteAccount() {
            showNotification('–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.', function() {
                if (currentUser) {
                    // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                    delete DB.users[currentUser.email];
                    
                    // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –≤—Å–µ—Ö –≥—Ä—É–ø–ø
                    Object.values(DB.groups).forEach(group => {
                        if (group.students) {
                            group.students = group.students.filter(email => email !== currentUser.email);
                        }
                    });
                    
                    // –£–¥–∞–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    Object.values(DB.grades).forEach(groupGrades => {
                        delete groupGrades[currentUser.email];
                    });
                    
                    saveData();
                    
                    // –í—ã—Ö–æ–¥–∏–º –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    document.getElementById('appContainer').style.display = 'none';
                    document.getElementById('authContainer').style.display = 'flex';
                    closeModal('profileModal');
                    
                    showNotification('–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω', '–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                }
            }, true);
        }
    </script>
</body>
</html>
